#include "stdafx.h"
#include "HuffmanCoding.h"

/***********************************************************************
* ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Æ£ï¿½
* HuffmanCoding()
*
*Ëµï¿½ï¿½ï¿½ï¿½ï¿½Þ²ï¿½ï¿½ï¿½ï¿½Ä¹ï¿½ï¿½ìº¯ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê¼ï¿½ï¿½ï¿½ï¿½Ô±ï¿½ï¿½ï¿½ï¿½
***********************************************************************/
HuffmanCoding::HuffmanCoding()
{


}

/***********************************************************************
* ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Æ£ï¿½
* HuffmanCoding()
*
*ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
*  CSize size -Í¼ï¿½ï¿½ï¿½Ð¡ï¿½ï¿½ï¿½í¡¢ï¿½ß£ï¿½
*  int nBitCount  -Î»ï¿½ï¿½
*  LPRGBQUAD lpColorTable  -ï¿½ï¿½É«ï¿½ï¿½Ö¸ï¿½ï¿½
*  unsigned char *pImgData  -Î»Í¼ï¿½ï¿½ï¿½ï¿½Ö¸ï¿½ï¿½
*
*ï¿½ï¿½ï¿½ï¿½Öµï¿½ï¿½
*   ï¿½ï¿½
*
*Ëµï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Îªï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ä¹ï¿½ï¿½ìº¯ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Î»Í¼ï¿½Ä´ï¿½Ð¡ï¿½ï¿½Ã¿ï¿½ï¿½ï¿½ï¿½Î»ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½É«ï¿½ï¿½
*      ï¿½ï¿½Î»Í¼ï¿½ï¿½ï¿½Ý£ï¿½ï¿½ï¿½ï¿½ï¿½ImgCenterDib()ï¿½Ô»ï¿½ï¿½ï¿½ï¿½Ô±ï¿½ï¿½Ê¼ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê¼ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
*      ï¿½ï¿½ï¿½Ý³ï¿½Ô±
***********************************************************************/
HuffmanCoding::HuffmanCoding(CSize size, int nBitCount, LPRGBQUAD lpColorTable, unsigned char *pImgData) :
ImgDib(size, nBitCount, lpColorTable, pImgData)
{
	dProba = new double[256];
}

/***********************************************************************
* ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Æ£ï¿½
*   ~HuffmanCoding()
*
*Ëµï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Í·ï¿½ï¿½ï¿½Ô´
***********************************************************************/

HuffmanCoding::~HuffmanCoding()
{
	if (dProba != NULL){
		delete[] dProba;
		dProba = NULL;
	}
}

/***********************************************************************
* ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Æ£ï¿½coding()
*
*Ëµï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ëº¯ï¿½ï¿½
***********************************************************************/
BOOL HuffmanCoding::coding(){
	int lineByte = (m_imgWidth*m_nBitCount / 8 + 3) / 4 * 4;
	int i = 0, j = 0;
	// ï¿½ï¿½ï¿½ï¿½Öµ
	for ( i = 0; i < 256; i++)
	{
		dProba[i] = 0.0;
	}

	// ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ò¶ï¿½Öµï¿½Ä¼ï¿½ï¿½ï¿½
	for (i = 0; i < m_imgHeight; i++)
	{
		for (j = 0; j < m_imgWidth; j++)
		{

			// ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½1
			dProba[*(m_pImgData + lineByte * i + j)] += 1;
		}
	}

	int pixelSum = m_imgHeight*m_imgWidth;

	// ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ò¶ï¿½Öµï¿½ï¿½ï¿½ÖµÄ¸ï¿½ï¿½ï¿½
	for (i = 0; i < 256; i++)
	{
		dProba[i] = (float)dProba[i] / pixelSum;
	}
	return TRUE;
}